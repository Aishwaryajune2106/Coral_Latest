import React, {useEffect, useState} from 'react';
import {
  View,
  Text,
  TextInput,
  TouchableOpacity,
  StyleSheet,
  ScrollView,
  Image,
  Alert,
  Modal,
  TouchableWithoutFeedback,
} from 'react-native';
import {Button} from 'react-native-elements';
import PhoneInput from 'react-native-phone-input';
import {Dropdown} from 'react-native-element-dropdown';
import DocumentPicker from 'react-native-document-picker';
import AppImages from '../../Constants/AppImages';
import AppColors from '../../Constants/AppColors';
import {ImageBackground} from 'react-native';
import axios from 'axios';
import AsyncStorage from '@react-native-async-storage/async-storage';
import AppStrings from '../../Constants/AppStrings';
import {FlatList} from 'react-native';
import {useTranslation} from 'react-i18next';

const EditProfile = ({navigation}) => {
  const {t} = useTranslation();
  const [name, setName] = useState('Messi');
  const [relationship, setRelationship] = useState('UAE');
  const [email, setEmail] = useState('youremail@domain.com');
  const [phone, setPhone] = useState('123-456-7890');
  const [country, setCountry] = useState('United States');
  const [gender, setGender] = useState('Female');
  const [address, setAddress] = useState('45 New Avenue, New York');
  const [idProof, setIdProof] = useState(null);
  const [fileName, setFileName] = useState('nationalityidproof.pdf');
  const [pdfFile, setPdfFile] = useState(null);
  const [modalVisible, setModalVisible] = useState(false);
  const [open, setOpen] = useState(false);
  const [isModalVisible, setIsModalVisible] = useState(false);
  const [isCurrencyFocus, setIsCurrencyFocus] = useState(false);

  const [searchQuery, setSearchQuery] = useState('');
  const [countryCode, setCountryCode] = useState('+81');
  const [items, setItems] = useState([
    {label: 'Passport', value: 'passport'},
    {label: 'National ID', value: 'national_id'},
    {label: 'Driving License', value: 'driving_license'},
  ]);

  const countries = [
    {name: 'Afghanistan', flag: 'ğŸ‡¦ğŸ‡«', currency: 'AFN'},
    {name: 'Albania', flag: 'ğŸ‡¦ğŸ‡±', currency: 'ALL'},
    {name: 'Algeria', flag: 'ğŸ‡©ğŸ‡¿', currency: 'DZD'},
    {name: 'Andorra', flag: 'ğŸ‡¦ğŸ‡©', currency: 'EUR'},
    {name: 'Angola', flag: 'ğŸ‡¦ğŸ‡´', currency: 'AOA'},
    {name: 'Antigua and Barbuda', flag: 'ğŸ‡¦ğŸ‡¬', currency: 'XCD'},
    {name: 'Argentina', flag: 'ğŸ‡¦ğŸ‡·', currency: 'ARS'},
    {name: 'Armenia', flag: 'ğŸ‡¦ğŸ‡²', currency: 'AMD'},
    {name: 'Australia', flag: 'ğŸ‡¦ğŸ‡º', currency: 'AUD'},
    {name: 'Austria', flag: 'ğŸ‡¦ğŸ‡¹', currency: 'EUR'},
    {name: 'Azerbaijan', flag: 'ğŸ‡¦ğŸ‡¿', currency: 'AZN'},
    {name: 'Bahamas', flag: 'ğŸ‡§ğŸ‡¸', currency: 'BSD'},
    {name: 'Bahrain', flag: 'ğŸ‡§ğŸ‡­', currency: 'BHD'},
    {name: 'Bangladesh', flag: 'ğŸ‡§ğŸ‡©', currency: 'BDT'},
    {name: 'Barbados', flag: 'ğŸ‡§ğŸ‡§', currency: 'BBD'},
    {name: 'Belarus', flag: 'ğŸ‡§ğŸ‡¾', currency: 'BYN'},
    {name: 'Belgium', flag: 'ğŸ‡§ğŸ‡ª', currency: 'EUR'},
    {name: 'Belize', flag: 'ğŸ‡§ğŸ‡¿', currency: 'BZD'},
    {name: 'Benin', flag: 'ğŸ‡§ğŸ‡¯', currency: 'XOF'},
    {name: 'Bhutan', flag: 'ğŸ‡§ğŸ‡¹', currency: 'BTN'},
    {name: 'Bolivia', flag: 'ğŸ‡§ğŸ‡´', currency: 'BOB'},
    {name: 'Bosnia and Herzegovina', flag: 'ğŸ‡§ğŸ‡¦', currency: 'BAM'},
    {name: 'Botswana', flag: 'ğŸ‡§ğŸ‡¼', currency: 'BWP'},
    {name: 'Brazil', flag: 'ğŸ‡§ğŸ‡·', currency: 'BRL'},
    {name: 'Brunei', flag: 'ğŸ‡§ğŸ‡³', currency: 'BND'},
    {name: 'Bulgaria', flag: 'ğŸ‡§ğŸ‡¬', currency: 'BGN'},
    {name: 'Burkina Faso', flag: 'ğŸ‡§ğŸ‡«', currency: 'XOF'},
    {name: 'Burundi', flag: 'ğŸ‡§ğŸ‡®', currency: 'BIF'},
    {name: 'Cambodia', flag: 'ğŸ‡°ğŸ‡­', currency: 'KHR'},
    {name: 'Cameroon', flag: 'ğŸ‡¨ğŸ‡²', currency: 'XAF'},
    {name: 'Canada', flag: 'ğŸ‡¨ğŸ‡¦', currency: 'CAD'},
    {name: 'Cape Verde', flag: 'ğŸ‡¨ğŸ‡»', currency: 'CVE'},
    {name: 'Chad', flag: 'ğŸ‡¹ğŸ‡©', currency: 'XAF'},
    {name: 'Chile', flag: 'ğŸ‡¨ğŸ‡±', currency: 'CLP'},
    {name: 'China', flag: 'ğŸ‡¨ğŸ‡³', currency: 'CNY'},
    {name: 'Colombia', flag: 'ğŸ‡¨ğŸ‡´', currency: 'COP'},
    {name: 'Comoros', flag: 'ğŸ‡°ğŸ‡²', currency: 'KMF'},
    {name: 'Congo', flag: 'ğŸ‡¨ğŸ‡¬', currency: 'XAF'},
    {name: 'Costa Rica', flag: 'ğŸ‡¨ğŸ‡·', currency: 'CRC'},
    {name: 'Croatia', flag: 'ğŸ‡­ğŸ‡·', currency: 'EUR'},
    {name: 'Cuba', flag: 'ğŸ‡¨ğŸ‡º', currency: 'CUP'},
    {name: 'Cyprus', flag: 'ğŸ‡¨ğŸ‡¾', currency: 'EUR'},
    {name: 'Czech Republic', flag: 'ğŸ‡¨ğŸ‡¿', currency: 'CZK'},
    {name: 'Denmark', flag: 'ğŸ‡©ğŸ‡°', currency: 'DKK'},
    {name: 'Djibouti', flag: 'ğŸ‡©ğŸ‡¯', currency: 'DJF'},
    {name: 'Dominica', flag: 'ğŸ‡©ğŸ‡²', currency: 'XCD'},
    {name: 'Dominican Republic', flag: 'ğŸ‡©ğŸ‡´', currency: 'DOP'},
    {name: 'Ecuador', flag: 'ğŸ‡ªğŸ‡¨', currency: 'USD'},
    {name: 'Egypt', flag: 'ğŸ‡ªğŸ‡¬', currency: 'EGP'},
    {name: 'El Salvador', flag: 'ğŸ‡¸ğŸ‡»', currency: 'USD'},
    {name: 'Estonia', flag: 'ğŸ‡ªğŸ‡ª', currency: 'EUR'},
    {name: 'Ethiopia', flag: 'ğŸ‡ªğŸ‡¹', currency: 'ETB'},
    {name: 'Fiji', flag: 'ğŸ‡«ğŸ‡¯', currency: 'FJD'},
    {name: 'Finland', flag: 'ğŸ‡«ğŸ‡®', currency: 'EUR'},
    {name: 'France', flag: 'ğŸ‡«ğŸ‡·', currency: 'EUR'},
    {name: 'Gabon', flag: 'ğŸ‡¬ğŸ‡¦', currency: 'XAF'},
    {name: 'Gambia', flag: 'ğŸ‡¬ğŸ‡²', currency: 'GMD'},
    {name: 'Georgia', flag: 'ğŸ‡¬ğŸ‡ª', currency: 'GEL'},
    {name: 'Germany', flag: 'ğŸ‡©ğŸ‡ª', currency: 'EUR'},
    {name: 'Ghana', flag: 'ğŸ‡¬ğŸ‡­', currency: 'GHS'},
    {name: 'Greece', flag: 'ğŸ‡¬ğŸ‡·', currency: 'EUR'},
    {name: 'Grenada', flag: 'ğŸ‡¬ğŸ‡©', currency: 'XCD'},
    {name: 'Guatemala', flag: 'ğŸ‡¬ğŸ‡¹', currency: 'GTQ'},
    {name: 'Guinea', flag: 'ğŸ‡¬ğŸ‡³', currency: 'GNF'},
    {name: 'Guyana', flag: 'ğŸ‡¬ğŸ‡¾', currency: 'GYD'},
    {name: 'Honduras', flag: 'ğŸ‡­ğŸ‡³', currency: 'HNL'},
    {name: 'Hungary', flag: 'ğŸ‡­ğŸ‡º', currency: 'HUF'},
    {name: 'Iceland', flag: 'ğŸ‡®ğŸ‡¸', currency: 'ISK'},
    {name: 'India', flag: 'ğŸ‡®ğŸ‡³', currency: 'INR'},
    {name: 'Indonesia', flag: 'ğŸ‡®ğŸ‡©', currency: 'IDR'},
    {name: 'Iran', flag: 'ğŸ‡®ğŸ‡·', currency: 'IRR'},
    {name: 'Iraq', flag: 'ğŸ‡®ğŸ‡¶', currency: 'IQD'},
    {name: 'Ireland', flag: 'ğŸ‡®ğŸ‡ª', currency: 'EUR'},
    {name: 'Israel', flag: 'ğŸ‡®ğŸ‡±', currency: 'ILS'},
    {name: 'Italy', flag: 'ğŸ‡®ğŸ‡¹', currency: 'EUR'},
    {name: 'Jamaica', flag: 'ğŸ‡¯ğŸ‡²', currency: 'JMD'},
    {name: 'Japan', flag: 'ğŸ‡¯ğŸ‡µ', currency: 'JPY'},
    {name: 'Jordan', flag: 'ğŸ‡¯ğŸ‡´', currency: 'JOD'},
    {name: 'Kazakhstan', flag: 'ğŸ‡°ğŸ‡¿', currency: 'KZT'},
    {name: 'Kenya', flag: 'ğŸ‡°ğŸ‡ª', currency: 'KES'},
    {name: 'Kiribati', flag: 'ğŸ‡°ğŸ‡®', currency: 'AUD'},
    {name: 'Kuwait', flag: 'ğŸ‡°ğŸ‡¼', currency: 'KWD'},
    {name: 'Kyrgyzstan', flag: 'ğŸ‡°ğŸ‡¬', currency: 'KGS'},
    {name: 'Laos', flag: 'ğŸ‡±ğŸ‡¦', currency: 'LAK'},
    {name: 'Latvia', flag: 'ğŸ‡±ğŸ‡»', currency: 'EUR'},
    {name: 'Lebanon', flag: 'ğŸ‡±ğŸ‡§', currency: 'LBP'},
    {name: 'Lesotho', flag: 'ğŸ‡±ğŸ‡¸', currency: 'LSL'},
    {name: 'Liberia', flag: 'ğŸ‡±ğŸ‡·', currency: 'LRD'},
    {name: 'Libya', flag: 'ğŸ‡±ğŸ‡¾', currency: 'LYD'},
    {name: 'Liechtenstein', flag: 'ğŸ‡±ğŸ‡®', currency: 'CHF'},
    {name: 'Lithuania', flag: 'ğŸ‡±ğŸ‡¹', currency: 'EUR'},
    {name: 'Luxembourg', flag: 'ğŸ‡±ğŸ‡º', currency: 'EUR'},
    {name: 'Madagascar', flag: 'ğŸ‡²ğŸ‡¬', currency: 'MGA'},
    {name: 'Malawi', flag: 'ğŸ‡²ğŸ‡¼', currency: 'MWK'},
    {name: 'Malaysia', flag: 'ğŸ‡²ğŸ‡¾', currency: 'MYR'},
    {name: 'Maldives', flag: 'ğŸ‡²ğŸ‡»', currency: 'MVR'},
    {name: 'Mali', flag: 'ğŸ‡²ğŸ‡±', currency: 'XOF'},
    {name: 'Malta', flag: 'ğŸ‡²ğŸ‡¹', currency: 'EUR'},
    {name: 'Marshall Islands', flag: 'ğŸ‡²ğŸ‡­', currency: 'USD'},
    {name: 'Mauritania', flag: 'ğŸ‡²ğŸ‡·', currency: 'MRU'},
    {name: 'Mauritius', flag: 'ğŸ‡²ğŸ‡º', currency: 'MUR'},
    {name: 'Mexico', flag: 'ğŸ‡²ğŸ‡½', currency: 'MXN'},
    {name: 'Micronesia', flag: 'ğŸ‡«ğŸ‡²', currency: 'USD'},
    {name: 'Moldova', flag: 'ğŸ‡²ğŸ‡©', currency: 'MDL'},
    {name: 'Monaco', flag: 'ğŸ‡²ğŸ‡¨', currency: 'EUR'},
    {name: 'Mongolia', flag: 'ğŸ‡²ğŸ‡³', currency: 'MNT'},
    {name: 'Montenegro', flag: 'ğŸ‡²ğŸ‡ª', currency: 'EUR'},
    {name: 'Morocco', flag: 'ğŸ‡²ğŸ‡¦', currency: 'MAD'},
    {name: 'Mozambique', flag: 'ğŸ‡²ğŸ‡¿', currency: 'MZN'},
    {name: 'Myanmar', flag: 'ğŸ‡²ğŸ‡²', currency: 'MMK'},
    {name: 'Namibia', flag: 'ğŸ‡³ğŸ‡¦', currency: 'NAD'},
    {name: 'Nauru', flag: 'ğŸ‡³ğŸ‡·', currency: 'AUD'},
    {name: 'Nepal', flag: 'ğŸ‡³ğŸ‡µ', currency: 'NPR'},
    {name: 'Netherlands', flag: 'ğŸ‡³ğŸ‡±', currency: 'EUR'},
    {name: 'New Zealand', flag: 'ğŸ‡³ğŸ‡¿', currency: 'NZD'},
    {name: 'Nicaragua', flag: 'ğŸ‡³ğŸ‡®', currency: 'NIO'},
    {name: 'Niger', flag: 'ğŸ‡³ğŸ‡ª', currency: 'XOF'},
    {name: 'Nigeria', flag: 'ğŸ‡³ğŸ‡¬', currency: 'NGN'},
    {name: 'North Korea', flag: 'ğŸ‡°ğŸ‡µ', currency: 'KPW'},
    {name: 'North Macedonia', flag: 'ğŸ‡²ğŸ‡°', currency: 'MKD'},
    {name: 'Norway', flag: 'ğŸ‡³ğŸ‡´', currency: 'NOK'},
    {name: 'Oman', flag: 'ğŸ‡´ğŸ‡²', currency: 'OMR'},
    {name: 'Pakistan', flag: 'ğŸ‡µğŸ‡°', currency: 'PKR'},
    {name: 'Palau', flag: 'ğŸ‡µğŸ‡¼', currency: 'USD'},
    {name: 'Palestine', flag: 'ğŸ‡µğŸ‡¸', currency: 'ILS'},
    {name: 'Panama', flag: 'ğŸ‡µğŸ‡¦', currency: 'PAB'},
    {name: 'Papua New Guinea', flag: 'ğŸ‡µğŸ‡¬', currency: 'PGK'},
    {name: 'Paraguay', flag: 'ğŸ‡µğŸ‡¾', currency: 'PYG'},
    {name: 'Peru', flag: 'ğŸ‡µğŸ‡ª', currency: 'PEN'},
    {name: 'Philippines', flag: 'ğŸ‡µğŸ‡­', currency: 'PHP'},
    {name: 'Poland', flag: 'ğŸ‡µğŸ‡±', currency: 'PLN'},
    {name: 'Portugal', flag: 'ğŸ‡µğŸ‡¹', currency: 'EUR'},
    {name: 'Qatar', flag: 'ğŸ‡¶ğŸ‡¦', currency: 'QAR'},
    {name: 'Romania', flag: 'ğŸ‡·ğŸ‡´', currency: 'RON'},
    {name: 'Russia', flag: 'ğŸ‡·ğŸ‡º', currency: 'RUB'},
    {name: 'Rwanda', flag: 'ğŸ‡·ğŸ‡¼', currency: 'RWF'},
    {name: 'Saint Kitts and Nevis', flag: 'ğŸ‡°ğŸ‡³', currency: 'XCD'},
    {name: 'Saint Lucia', flag: 'ğŸ‡±ğŸ‡¨', currency: 'XCD'},
    {name: 'Saint Vincent and the Grenadines', flag: 'ğŸ‡»ğŸ‡¨', currency: 'XCD'},
    {name: 'Samoa', flag: 'ğŸ‡¼ğŸ‡¸', currency: 'WST'},
    {name: 'San Marino', flag: 'ğŸ‡¸ğŸ‡²', currency: 'EUR'},
    {name: 'Saudi Arabia', flag: 'ğŸ‡¸ğŸ‡¦', currency: 'SAR'},
    {name: 'Senegal', flag: 'ğŸ‡¸ğŸ‡³', currency: 'XOF'},
    {name: 'Serbia', flag: 'ğŸ‡·ğŸ‡¸', currency: 'RSD'},
    {name: 'Seychelles', flag: 'ğŸ‡¸ğŸ‡¨', currency: 'SCR'},
    {name: 'Sierra Leone', flag: 'ğŸ‡¸ğŸ‡±', currency: 'SLL'},
    {name: 'Singapore', flag: 'ğŸ‡¸ğŸ‡¬', currency: 'SGD'},
    {name: 'Slovakia', flag: 'ğŸ‡¸ğŸ‡°', currency: 'EUR'},
    {name: 'Slovenia', flag: 'ğŸ‡¸ğŸ‡®', currency: 'EUR'},
    {name: 'Solomon Islands', flag: 'ğŸ‡¸ğŸ‡§', currency: 'SBD'},
    {name: 'Somalia', flag: 'ğŸ‡¸ğŸ‡´', currency: 'SOS'},
    {name: 'South Africa', flag: 'ğŸ‡¿ğŸ‡¦', currency: 'ZAR'},
    {name: 'South Korea', flag: 'ğŸ‡°ğŸ‡·', currency: 'KRW'},
    {name: 'South Sudan', flag: 'ğŸ‡¸ğŸ‡¸', currency: 'SSP'},
    {name: 'Spain', flag: 'ğŸ‡ªğŸ‡¸', currency: 'EUR'},
    {name: 'Sri Lanka', flag: 'ğŸ‡±ğŸ‡°', currency: 'LKR'},
    {name: 'Sudan', flag: 'ğŸ‡¸ğŸ‡©', currency: 'SDG'},
    {name: 'Suriname', flag: 'ğŸ‡¸ğŸ‡·', currency: 'SRD'},
    {name: 'Sweden', flag: 'ğŸ‡¸ğŸ‡ª', currency: 'SEK'},
    {name: 'Switzerland', flag: 'ğŸ‡¨ğŸ‡­', currency: 'CHF'},
    {name: 'Syria', flag: 'ğŸ‡¸ğŸ‡¾', currency: 'SYP'},
    {name: 'Tajikistan', flag: 'ğŸ‡¹ğŸ‡¯', currency: 'TJS'},
    {name: 'Tanzania', flag: 'ğŸ‡¹ğŸ‡¿', currency: 'TZS'},
    {name: 'Thailand', flag: 'ğŸ‡¹ğŸ‡­', currency: 'THB'},
    {name: 'Timor-Leste', flag: 'ğŸ‡¹ğŸ‡±', currency: 'USD'},
    {name: 'Togo', flag: 'ğŸ‡¹ğŸ‡¬', currency: 'XOF'},
    {name: 'Tonga', flag: 'ğŸ‡¹ğŸ‡´', currency: 'TOP'},
    {name: 'Trinidad and Tobago', flag: 'ğŸ‡¹ğŸ‡¹', currency: 'TTD'},
    {name: 'Tunisia', flag: 'ğŸ‡¹ğŸ‡³', currency: 'TND'},
    {name: 'Turkey', flag: 'ğŸ‡¹ğŸ‡·', currency: 'TRY'},
    {name: 'Turkmenistan', flag: 'ğŸ‡¹ğŸ‡²', currency: 'TMT'},
    {name: 'Tuvalu', flag: 'ğŸ‡¹ğŸ‡»', currency: 'AUD'},
    {name: 'Uganda', flag: 'ğŸ‡ºğŸ‡¬', currency: 'UGX'},
    {name: 'Ukraine', flag: 'ğŸ‡ºğŸ‡¦', currency: 'UAH'},
    {name: 'United Arab Emirates', flag: 'ğŸ‡¦ğŸ‡ª', currency: 'AED'},
    {name: 'United Kingdom', flag: 'ğŸ‡¬ğŸ‡§', currency: 'GBP'},
    {name: 'United States', flag: 'ğŸ‡ºğŸ‡¸', currency: 'USD'},
    {name: 'Uruguay', flag: 'ğŸ‡ºğŸ‡¾', currency: 'UYU'},
    {name: 'Uzbekistan', flag: 'ğŸ‡ºğŸ‡¿', currency: 'UZS'},
    {name: 'Vanuatu', flag: 'ğŸ‡»ğŸ‡º', currency: 'VUV'},
    {name: 'Vatican City', flag: 'ğŸ‡»ğŸ‡¦', currency: 'EUR'},
    {name: 'Venezuela', flag: 'ğŸ‡»ğŸ‡ª', currency: 'VES'},
    {name: 'Vietnam', flag: 'ğŸ‡»ğŸ‡³', currency: 'VND'},
    {name: 'Yemen', flag: 'ğŸ‡¾ğŸ‡ª', currency: 'YER'},
    {name: 'Zambia', flag: 'ğŸ‡¿ğŸ‡²', currency: 'ZMW'},
    {name: 'Zimbabwe', flag: 'ğŸ‡¿ğŸ‡¼', currency: 'ZWL'},
  ];

  // Create currency dropdown data from countries array
  const currencyData = countries.map(country => ({
    label: `${country.currency} - ${country.name}`,
    value: country.currency,
    flag: country.flag,
  }));

  // Remove duplicates and sort
  const uniqueCurrencies = currencyData
    .filter(
      (currency, index, self) =>
        index === self.findIndex(c => c.value === currency.value),
    )
    .sort((a, b) => a.label.localeCompare(b.label));

  const handleFileUpload = async () => {
    try {
      const res = await DocumentPicker.pick({
        type: [DocumentPicker.types.pdf],
      });

      if (res && res[0]) {
        setPdfFile(res[0]);
        setFileName(res[0].name);
      }
    } catch (err) {
      if (DocumentPicker.isCancel(err)) {
        Alert.alert('File selection canceled');
      } else {
        Alert.alert('Error selecting file', err.message);
      }
    }
  };

  const [profile, setProfile] = useState({
    name: '',
    email: '',
    phone: '',
    country: '',
    gender: '',
    u_address: '',
    currency: '',
  });

  useEffect(() => {
    fetchUserProfile();
  }, []);

  const fetchUserProfile = async () => {
    const user_id = await AsyncStorage.getItem(AppStrings.USER_ID);
    try {
      const response = await axios.get(
        'https://coral.lunarsenterprises.com/wealthinvestment/user',
        {
          headers: {
            user_id: user_id,
          },
        },
      );

      if (response.data.result) {
        const userData = response.data.data[0];
        setProfile({
          name: userData.u_name || '',
          email: userData.u_email || '',
          phone: userData.u_mobile ? userData.u_mobile.toString() : '',
          country: userData.u_country || '',
          gender: userData.u_gender || '',
          address: userData.u_address || '',
          currency: userData.u_currency || '',
        });
        console.log('profilee', profile);
      } else {
        Alert.alert('Error', response.data.message);
      }
    } catch (error) {
      Alert.alert('Error fetching profile', error.message);
    }
  };

  const handleEditProfile = async () => {
    const user_id = await AsyncStorage.getItem(AppStrings.USER_ID);

    if (!user_id) {
      Alert.alert('Error', 'User ID not found');
      return;
    }

    const payload = {
      u_currency: profile.currency,
      u_gender: profile.gender,
      u_address: profile.address,
      u_mobile: Number(profile.phone),
      u_country: profile.country,
    };

    try {
      const response = await axios.post(
        'https://coral.lunarsenterprises.com/wealthinvestment/user/edit',
        payload,
        {
          headers: {
            user_id: user_id,
          },
        },
      );

      if (response.data.result) {
        console.log(profile, 'profileeee');
        setModalVisible(true);
      } else {
        console.log(profile, 'profileeee');
        Alert.alert('Error', response.data.message);
      }
    } catch (error) {
      Alert.alert('Error', 'Failed to update profile');
    }
  };

  // Filtered country list based on search
  const filteredCountries =
    countries?.filter(country =>
      country?.name?.toLowerCase().includes(searchQuery.toLowerCase()),
    ) || [];

  // Render Country Item
  const renderCountryItem = ({item}) => (
    <TouchableOpacity
      style={styles.countryItem}
      onPress={() => {
        setCountryCode(item.flag);
        setIsModalVisible(false);
      }}>
      <Text
        style={{
          color: AppColors.white,
          fontSize: 17,
          fontFamily: 'serif',
          fontWeight: 'bold',
        }}>{`${item.flag} ${item.name} (${item.currency})`}</Text>
    </TouchableOpacity>
  );

  // Function to close modal
  const handleBackToLogin = () => {
    navigation.goBack();
  };

  return (
    <ScrollView contentContainerStyle={styles.container}>
      {/* Name */}
      <Text style={styles.label}>{t('Full Name')}</Text>
      <TextInput
        style={styles.input}
        value={profile.name}
        onChangeText={text => setProfile({...profile, name: text})}
        editable={false}
      />

      {/* Currency Dropdown */}
      <Text style={styles.label}>{t('Currency')}</Text>
      <Dropdown
        style={[
          styles.dropdown,
          isCurrencyFocus && styles.focusedDropdown, // or {borderColor: AppColors.Yellow}
        ]}
        placeholderStyle={styles.placeholderStyle}
        selectedTextStyle={styles.selectedTextStyle}
        inputSearchStyle={styles.inputSearchStyle}
        iconStyle={styles.iconStyle}
        containerStyle={styles.dropdownContainer} // Add this for list container
        itemContainerStyle={styles.dropdownItem} // Add this for individual items
        itemTextStyle={styles.dropdownItemText} // Add this for item text
        data={uniqueCurrencies}
        search
        maxHeight={300}
        labelField="label"
        valueField="value"
        placeholder={!isCurrencyFocus ? 'Select Currency' : '...'}
        searchPlaceholder="Search currency..."
        value={profile.currency}
        onFocus={() => setIsCurrencyFocus(true)}
        onBlur={() => setIsCurrencyFocus(false)}
        onChange={item => {
          setProfile({...profile, currency: item.value});
          setIsCurrencyFocus(false);
        }}
        renderLeftIcon={() => (
          <View style={styles.icon}>
            <Text style={styles.iconText}>ğŸ’°</Text>
          </View>
        )}
      />

      {/* Email */}
      <Text style={styles.label}>{t('Email')}</Text>
      <TextInput
        style={styles.input}
        value={profile.email}
        keyboardType="email-address"
        onChangeText={text => setProfile({...profile, email: text})}
        editable={false}
      />

      {/* Phone Number */}
      <Text style={styles.label}>{t('Phone Number')}</Text>
      <View style={styles.phoneContainer}>
        <TouchableOpacity
          style={styles.countryCodeButton}
          onPress={() => setIsModalVisible(true)}>
          <Text style={styles.countryText}>{countryCode}</Text>
        </TouchableOpacity>
        <TextInput
          placeholder="123-456-7890"
          placeholderTextColor={AppColors.Grey}
          value={profile.phone || ''}
          onChangeText={text => setProfile({...profile, phone: text})}
          style={styles.phoneinput}
          keyboardType="phone-pad"
          maxLength={15}
        />
      </View>

      {/* Country & Gender Row */}
      <View style={styles.row}>
        <View style={styles.halfWidth}>
          <Text style={styles.label}>{t('Country')}</Text>
          <TextInput
            style={styles.input}
            value={profile.country}
            onChangeText={text => setProfile({...profile, country: text})}
          />
        </View>
        <View style={styles.halfWidth}>
          <Text style={styles.label}>{t('Gender')}</Text>
          <TextInput
            style={styles.input}
            value={profile.gender || ''}
            onChangeText={text => setProfile({...profile, gender: text})}
          />
        </View>
      </View>

      {/* Address */}
      <Text style={styles.label}>{t('Address')}</Text>
      <TextInput
        style={styles.input}
        value={profile.address}
        onChangeText={text => setProfile({...profile, address: text})}
      />

      {/* SUBMIT Button */}
      <Button
        title={t('SUBMIT')}
        buttonStyle={styles.downloadButton}
        titleStyle={styles.buttonText}
        onPress={handleEditProfile}
      />

      {/* Success Modal */}
      <Modal transparent={true} visible={modalVisible} animationType="slide">
        <TouchableWithoutFeedback onPress={() => setModalVisible(false)}>
          <View style={styles.modalContainer}>
            <TouchableWithoutFeedback>
              <View style={styles.modalContent}>
                <ImageBackground
                  source={AppImages.Successtick}
                  style={styles.backgroundImage}
                />
                <Text style={styles.successMessage}>
                  {t('Profile Edit Successful')}!
                </Text>

                <TouchableOpacity
                  style={styles.button}
                  onPress={handleBackToLogin}>
                  <Text style={styles.buttonText}>{t('Back To profile')}</Text>
                </TouchableOpacity>
              </View>
            </TouchableWithoutFeedback>
          </View>
        </TouchableWithoutFeedback>
      </Modal>

      <Modal
        visible={isModalVisible}
        onRequestClose={() => setIsModalVisible(false)}>
        <View style={styles.modalContainer1}>
          <TextInput
            style={styles.searchInput}
            placeholder="Search Country"
            placeholderTextColor={AppColors.Grey}
            value={searchQuery}
            onChangeText={setSearchQuery}
          />
          <FlatList
            data={filteredCountries}
            scrollEnabled={false}
            keyExtractor={(item, index) => index.toString()}
            renderItem={renderCountryItem}
            contentContainerStyle={styles.list}
          />
        </View>
      </Modal>
    </ScrollView>
  );
};

const styles = StyleSheet.create({
  container: {
    flex: 1,
    padding: 20,
    backgroundColor: '#fff',
  },
  label: {
    fontSize: 14,
    color: '#888',
    marginBottom: 5,
  },
  input: {
    backgroundColor: '#f3f6fb',
    padding: 12,
    borderRadius: 8,
    marginBottom: 15,
  },
  phoneInput: {
    backgroundColor: '#f3f6fb',
    padding: 12,
    borderRadius: 8,
    marginBottom: 15,
  },
  row: {
    flexDirection: 'row',
    justifyContent: 'space-between',
  },
  halfWidth: {
    width: '48%',
  },
  dropdown: {
    marginBottom: 15,
    borderColor: AppColors.Grey,
    borderWidth: 0.5,
    borderRadius: 20,
    padding: 10,
  },
  uploadContainer: {
    flexDirection: 'row',
    alignItems: 'center',
    backgroundColor: '#f3f6fb',
    borderRadius: 8,
    marginBottom: 20,
  },
  uploadInput: {
    flex: 1,
    padding: 12,
  },
  uploadButton: {
    padding: 10,
    borderRadius: 5,
  },
  instructionText: {
    textAlign: 'center',
    fontSize: 12,
    color: '#333',
    marginBottom: 15,
    fontWeight: '700',
    fontFamily: 'Roboto',
  },
  downloadButton: {
    backgroundColor: AppColors.Yellow,
    padding: 15,
    borderRadius: 8,
    marginVertical: 20,
  },
  buttonText: {
    fontSize: 16,
    // fontWeight: 'bold',
  },
  uploadImage: {
    width: 24,
    height: 24,
  },
  // Modal styles
  modalContainer: {
    flex: 1,
    justifyContent: 'center',
    alignItems: 'center',
    backgroundColor: 'rgba(0,0,0,0.5)',
  },
  modalContent: {
    width: 350, // Increase width
    backgroundColor: 'white',
    borderRadius: 10,
    alignItems: 'center',
    padding: 30, // Increase padding for more spacing
  },
  backgroundImage: {
    width: 150,
    height: 150,
    marginBottom: 25,
    resizeMode: 'contain',
  },
  successMessage: {
    fontSize: 20,
    fontWeight: 'bold',
    color: '#A6BCFF',
    marginBottom: 15,
    textAlign: 'center',
  },
  successMessage1: {
    fontSize: 13,
    color: AppColors.red,
    marginBottom: 25,
  },
  button: {
    backgroundColor: AppColors.Yellow,
    paddingVertical: 8, // Increase button padding
    paddingHorizontal: 25,
    borderRadius: 8,
    marginTop: 20,
  },
  buttonText: {
    fontSize: 18, // Increase font size
    color: 'white',
    fontFamily: 'serif',
    // fontWeight: 'bold',
  },
  errorText: {
    color: 'red',
    fontSize: 14,
    marginTop: 5,
  },
  phoneinput: {
    borderWidth: 1,
    borderColor: AppColors.Grey,
    borderRadius: 8,
    padding: 10,
    marginBottom: 10,
    marginVertical: 10,
    color: AppColors.Black,
    width: '80%',
  },
  phoneContainer: {flexDirection: 'row', alignItems: 'center'},
  countryCodeButton: {
    padding: 10,
    borderWidth: 1,
    borderColor: AppColors.Grey,
    borderRadius: 8,
    marginRight: 10,
  },
  countryCodeText: {color: AppColors.Black},
  phoneInput: {flex: 1},
  countryItem: {padding: 10, borderBottomWidth: 1, borderColor: AppColors.Grey},
  countryText: {fontSize: 16, color: AppColors.Black},
  searchInput: {
    backgroundColor: AppColors.OffWhite,
    paddingHorizontal: 20,
    borderRadius: 8,
    marginBottom: 20,
    color: AppColors.Black,
  },
  modalContainer1: {flex: 1, padding: 20, backgroundColor: AppColors.Ash},
});

export default EditProfile;
